$(function(){function t(t){return $.isNumeric(t)?t*Math.PI/180:0}var a=function(t,e){var n,i,o,l,r=null,s=t[0].getContext("2d"),d=2*Math.PI,c=this;this.onChange=function(){},this.onCancel=function(){},this.onRelease=function(){},this.val=function(t){if(null==t){var a,s;return a=s=Math.atan2(n-o,-(i-l-e.width/2))-e.angleOffset,0>s&&(a=s+d),t=Math.round(a*(e.max-e.min)/d)+e.min,t>e.max?e.max:t}e.stopper&&(t=Math.max(Math.min(t,e.max),e.min)),r=t,this.onChange(t),this.draw(t)},this.change=function(t){e.stopper&&(t=Math.max(Math.min(t,e.max),e.min)),this.onChange(t),this.draw(t)},this.angle=function(t){return(t-e.min)*d/(e.max-e.min)},this.draw=function(t){var n,i=this.angle(t),o=1.5*Math.PI+e.angleOffset,l=o,d=o+this.angle(r),c=l+i,u=e.width/2,h=u*e.thickness,f=a.getCgColor(e.cgColor);if(s.clearRect(0,0,e.width,e.width),s.lineWidth=h,!e.draw(i,r,e,s)){for(n=0;n<e.ticks;n++){s.beginPath(),s.strokeStyle=i>2*Math.PI/e.ticks*n&&e.tickColorizeValues?e.fgColor:e.tickColor;var g=2*Math.PI/e.ticks*n-.5*Math.PI;s.arc(u,u,u-h-e.tickLength,g,g+e.tickWidth,!1),s.stroke()}switch(e.cursor&&(o=d-.3)&&(d+=.3)&&(l=c-.3)&&(c+=.3),e.skin){case"tron":e.displayPrevious&&(s.beginPath(),s.strokeStyle=r==t?e.fgColor:f,s.arc(u,u,u-h,o,d,!1),s.stroke()),s.beginPath(),s.strokeStyle=e.fgColor,s.arc(u,u,u-h,l,c,!1),s.stroke(),s.lineWidth=2,s.beginPath(),s.strokeStyle=e.fgColor,s.arc(u,u,u-h+1+2*h/3,0,2*Math.PI,!1),s.stroke()}}},this.capture=function(t){switch(t.type){case"mousemove":case"mousedown":n=t.pageX,i=t.pageY;break;case"touchmove":case"touchstart":n=t.originalEvent.touches[0].pageX,i=t.originalEvent.touches[0].pageY}this.change(this.val())},this.cancel=function(){c.val(r),c.onCancel()},this.startDrag=function(a){var n=t.offset(),i=$(document);o=n.left+e.width/2,l=n.top,this.capture(a),i.bind("mousemove.dial touchmove.dial",function(t){c.capture(t)}).bind("keyup.dial",function(t){27===t.keyCode&&(i.unbind("mouseup.dial mousemove.dial keyup.dial"),c.cancel())}).bind("mouseup.dial touchend.dial",function(){i.unbind("mousemove.dial touchmove.dial mouseup.dial touchend.dial keyup.dial"),c.val(c.val()),c.onRelease(r)})}};a.getCgColor=function(t){t=t.substring(1,7);var a=[parseInt(t.substring(0,2),16),parseInt(t.substring(2,4),16),parseInt(t.substring(4,6),16)];return"rgba("+a[0]+","+a[1]+","+a[2]+",.5)"},$.fn.knob=$.fn.dial=function(e){return this.each(function(){var n,i=$(this);if(i.data("dialed"))return i;i.data("dialed",!0),n=$.extend({min:i.data("min")||0,max:i.data("max")||100,stopper:!0,readOnly:i.data("readonly"),cursor:i.data("cursor"),thickness:i.data("thickness")||.35,width:i.data("width")||200,displayInput:null==i.data("displayinput")||i.data("displayinput"),displayPrevious:i.data("displayprevious"),fgColor:i.data("fgcolor")||"#87CEEB",cgColor:i.data("cgcolor")||i.data("fgcolor")||"#87CEEB",bgColor:i.data("bgcolor")||"#EEEEEE",tickColor:i.data("tickColor")||i.data("fgcolor")||"#DDDDDD",ticks:i.data("ticks")||0,tickLength:i.data("tickLength")||0,tickWidth:i.data("tickWidth")||.02,tickColorizeValues:i.data("tickColorizeValues")||!0,skin:i.data("skin")||"default",angleOffset:t(i.data("angleoffset")),draw:function(){},change:function(){},release:function(){}},e);var o,l=$('<canvas width="'+n.width+'" height="'+n.width+'"></canvas>'),r=$("<div style=width:"+n.width+'px;"></div>'),s=i.val(),d=function(){n.displayInput&&i.css({width:n.width/2+"px",position:"absolute","margin-top":5*n.width/14+"px","margin-left":"-"+3*n.width/4+"px","font-size":n.width/4+"px",border:"none",background:"none","font-family":"Arial","font-weight":"bold","text-align":"center",color:n.fgColor,padding:"0px","-webkit-appearance":"none"})||i.css({width:"0px",visibility:"hidden"})};if(i.wrap(r).before(l),d(),o=new a(l,n),s||(s=n.min),i.val(s),o.val(s),o.onRelease=function(t){n.release(t,i)},o.onChange=function(t){i.val(t),n.change(t)},i.bind("change",function(){o.val(i.val())}),n.readOnly)i.attr("readonly","readonly");else{l.bind("mousedown touchstart",function(t){t.preventDefault(),o.startDrag(t)}).bind("mousewheel DOMMouseScroll",mw=function(t){t.preventDefault();var a=t.originalEvent,e=a.detail||a.wheelDeltaX,n=a.detail||a.wheelDeltaY,l=parseInt(i.val())+(e>0||n>0?1:0>e||0>n?-1:0);o.val(l)});var c,u,h=1,f={37:-1,38:1,39:1,40:-1};i.bind("configure",function(t,a){var e;for(e in a)n[e]=a[e];d(),o.val(i.val())}).bind("keydown",function(t){var a=t.keyCode;a>=96&&105>=a&&(a-=48),c=parseInt(String.fromCharCode(a)),isNaN(c)&&(13!==a&&8!==a&&9!==a&&189!==a&&t.preventDefault(),$.inArray(a,[37,38,39,40])>-1&&(o.change(parseInt(i.val())+f[a]*h),u=window.setTimeout(function(){20>h&&h++},50),t.preventDefault()))}).bind("keyup",function(t){isNaN(c)?u?(window.clearTimeout(u),u=null,h=1,o.val(i.val()),o.onRelease(i.val(),i)):13===t.keyCode&&o.onRelease(i.val(),i):i.val()>n.max&&i.val(n.max)||i.val()<n.min&&i.val(n.min)}).bind("mousewheel DOMMouseScroll",mw)}}).parent()}});