//#######################################################
// This is the universal javascript. Nothing should be 
// loaded until everything has been downloaded.

$(document).ready(function () {

// when js has loaded run foundation
    $(document).foundation();
	if (!Modernizr.inlinesvg) {
		$('.svg-blinelogo').attr("src", "https://www.irishlife.ie/secureWeb/uploadedImages/bline/foundation_responsive/img/bline-logo.png");
		$('.svg-irishlifelogo-white').attr("src", "https://www..ie/secureWeb/uploadedImages/bline/foundation_responsive/img/irishlife-logo-white.png");
	}
	checkForAcceptCookies();
	// listen to the person pressing the enter key for search
	initEnterKeyListener(); 
});

// fade the menu in
	$('.menu').fadeIn();
/*
 * Drop down menus that work on ie8
 * Dropit v1.0
 * http://dev7studios.com/dropit
 *
 * Copyright 2012, Dev7studios
 * Free to use and abuse under the MIT license.
 * http://www.opensource.org/licenses/mit-license.php
 */

;(function($) {

console.log("inside dropit");
    $.fn.dropit = function(method) {

        var methods = {

            init : function(options) {
                this.dropit.settings = $.extend({}, this.dropit.defaults, options);
                return this.each(function() {
                    var $el = $(this),
                         el = this,
                         settings = $.fn.dropit.settings;
                    
                    // Hide initial submenus     
                    $el.addClass('dropit')
                    .find('>'+ settings.triggerParentEl +':has('+ settings.submenuEl +')').addClass('dropit-trigger')
                    .find(settings.submenuEl).addClass('dropit-submenu').hide();
                    
                    // Open on click
                    $el.on(settings.action, settings.triggerParentEl +':has('+ settings.submenuEl +') > '+ settings.triggerEl +'', function(){
                        if($(this).parents(settings.triggerParentEl).hasClass('dropit-open')) return false;
                        settings.beforeHide.call(this);
                        $('.dropit-open').removeClass('dropit-open').find('.dropit-submenu').hide();
                        settings.afterHide.call(this);
                        settings.beforeShow.call(this);
                        $(this).parents(settings.triggerParentEl).addClass('dropit-open').find(settings.submenuEl).show();
                        settings.afterShow.call(this);
                        return false;
                    });
                    
                    // Close if outside click
                    $(document).on('click', function(){
                        settings.beforeHide.call(this);
                        $('.dropit-open').removeClass('dropit-open').find('.dropit-submenu').hide();
                        settings.afterHide.call(this);
                    });
                    
                    settings.afterLoad.call(this);
                });
            }
            
        }

        if (methods[method]) {
            return methods[method].apply(this, Array.prototype.slice.call(arguments, 1));
        } else if (typeof method === 'object' || !method) {
            return methods.init.apply(this, arguments);
        } else {
            $.error( 'Method "' +  method + '" does not exist in dropit plugin!');
        }

    }

    $.fn.dropit.defaults = {
        action: 'click', // The open action for the trigger
        submenuEl: 'ul', // The submenu element
        triggerEl: 'a', // The trigger element
        triggerParentEl: 'li', // The trigger parent element
        afterLoad: function(){}, // Triggers when plugin has loaded
        beforeShow: function(){}, // Triggers before submenu is shown
        afterShow: function(){}, // Triggers after submenu is shown
        beforeHide: function(){}, // Triggers before submenu is hidden
        afterHide: function(){} // Triggers before submenu is hidden
    }

    $.fn.dropit.settings = {}

console.log("inside dropit 2");
})(jQuery);

console.log("before dropit");
$('.menu').dropit({ action: 'hover' });

console.log("after dropit");
// Track a page name in Google Analytics
gaqTrackPage = function(pageName){
	if(_gaq){
		_gaq.push(['_trackPageview',pageName]);
	}
	// console.log("track: "+pagename)
}

$('.menu li a').each(function(i) 
	{		
		var link = $(this).attr('href').substring(1,$(this).attr('href').lastIndexOf('/')).toLowerCase();
		if ($(this).attr('href').indexOf('openSecureDoc') > -1 )
		{
			$(this).attr('onclick',"if (_gaq) _gaq.push(['_trackEvent', 'Nav Menu', '"+$(this).text() + "']);return true");
		}
		else if ($(this).attr('href').indexOf('javascript') == -1)
		{
			$(this).attr('onclick',"if (_gaq) _gaq.push(['_trackEvent', 'Nav Menu', '"+link + "']);return true");
		}
	
	});

//######################################################################
// This is used for the google search box on 
// the top right of the webpage.
// 
// @autor Stephen Hayden
//  @date 14/Feb/2012 
$('.search').click(function(){

	performSearch();
});
function performSearch()
{
	var search = $('#searchInput').val();
	if (search != "")
	{
		search = search.replace(/ /g,'+');
		window.location='/search-bline.html?search='+search;
	}
	else{
	alertify.error("Nothing to search. Enter text.");
	}
}

function initEnterKeyListener()
{
	$(document).keydown(function(e)
	{
		var keynum = e.which || e.keyCode;
		if(keynum == 13){try{performSearch(); }catch(e){}}
	});
}

//
//#########################################################################


function openOnlineServicesWindow(theURL,winName)
{	
    var myWin = window.open(theURL ,winName);
            if (myWin == null || typeof(myWin)=='undefined')
                alert("Turn off your pop-up blocker!\n\nWe try to open the following url:\n"+theURL);
}
function launchOnlineServices()
{
	$.get("/servlet/loggedOn", function(data){
	str = jQuery.trim(data);
		if (_gaq) _gaq.push(['_trackPageview','/B-line/launch-MyBiz.html']);
		mkVisitWebPage('/B-line/launch.html');
		if (str == 'Y') 
		{
			openOnlineServicesWindow('/servlet/launchOnlineServices','BlineMyBiz');
		}
		else
		{
			openOnlineServicesWindow('https://www.b-line.ie','BlineMyBiz');
			//openOnlineServicesWindow('https://www.bline.ie/secure/openSecureDoc?imageTypeId=1&documentId=98','BlineMyBiz');
		}
		
				
	});
}

function timestampPdfs()
{
 	var ts=new Date().getTime();
	$('a[href$=".pdf"]').each(function(i) 
	{
		var link = $(this).attr('href');
		
		if (link.indexOf('/') > -1)
		{
			link = link.substr(link.lastIndexOf('/')+1);
		}
		
		$(this).attr('href',
		$(this).attr('href') + '?ts='+ts);		
		$(this).attr('onclick',"if (_gaq) _gaq.push(['_trackEvent', 'PDF download', '"+link + "']);return true");
		$(this).attr('target','_blank');
		
	});
}






function acceptCookies(){
	//setCookie("AcceptCookies","true",365);
	$.cookie('AcceptCookies',"true", 365);
	//location.reload();
	$('#cookiesnote').slideUp('slow');
}
function checkForAcceptCookies()
{

	if(!$.cookie('AcceptCookies')){
		
	var cookies = "<div id=\"cookiesnote\"><div class=\"row\"><div class=\"large-9 columns\"><h6>Important information regarding cookies</h6><p>Irish Life uses cookies to enhance your browsing experience and to create a secure and effective website for our customers. By using this site you agree that we may store and access cookies on your device, unless you have disabled your cookies. </p><p><a href='http://www.bline.ie/site/privacy-policy.html'>You can find out more about our cookies here.</a></p></div><div class=\"large-3 columns\"><br/><br/><a onclick=\"acceptCookies()\" href=\"javascript:void(0)\" class=\"expand success button radius\">I have read this notice <i class=\"icon-ok\"></i></a></div></div></div>";
	$('body').prepend(cookies);
	}
}


// http://www.bline.ie/search-bline.html?search=rub